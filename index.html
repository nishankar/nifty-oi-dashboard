<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>OI QUANT SCALPER</title>
<style>
body { font-family: Arial; background:#0d1117; color:white; padding:10px;}
h2 { text-align:center; }
.card { background:#161b22; padding:12px; margin:10px 0; border-radius:10px;}
.green { color:#00ff90; }
.red { color:#ff4d4d; }
.yellow { color:#ffd700; }
.blue { color:#00bfff; }
button { padding:8px 12px; margin:5px; background:#21262d; color:white; border:none; border-radius:6px;}
.meter { height:10px; background:#333; border-radius:5px; margin-top:5px;}
.fill { height:10px; background:#00ff90; border-radius:5px;}
</style>
</head>
<body>

<h2>OI QUANT SCALPER</h2>

<div style="text-align:center;">
<button onclick="setSymbol('NIFTY')">NIFTY</button>
<button onclick="setSymbol('BANKNIFTY')">BANKNIFTY</button>
</div>

<div class="card" id="summary"></div>

<div class="card">
Momentum Strength
<div class="meter"><div id="momentumBar" class="fill" style="width:50%"></div></div>
</div>

<script>

let symbol="NIFTY";
let previousSpot=null;
let priceMemory=[];
let oiDeltaMemory=[];

function setSymbol(sym){
    symbol=sym;
    previousSpot=null;
    priceMemory=[];
    oiDeltaMemory=[];
    fetchData();
}

async function fetchData(){

    await fetch("https://www.nseindia.com");

    const response=await fetch(`https://www.nseindia.com/api/option-chain-indices?symbol=${symbol}`,{
        headers:{
            "User-Agent":"Mozilla/5.0",
            "Accept":"application/json",
            "Referer":"https://www.nseindia.com/option-chain"
        }
    });

    const data=await response.json();
    const records=data.records.data;
    const spot=data.records.underlyingValue;

    // 1-MIN DIRECTION MEMORY
    priceMemory.push(spot);
    if(priceMemory.length>10) priceMemory.shift();

    let candleDir="Flat";
    if(previousSpot){
        if(spot>previousSpot) candleDir="Bullish";
        if(spot<previousSpot) candleDir="Bearish";
    }
    previousSpot=spot;

    // ATM FIND
    let strikes=records.map(r=>r.strikePrice);
    let atm=strikes.reduce((prev,curr)=>
        Math.abs(curr-spot)<Math.abs(prev-spot)?curr:prev
    );

    let callPressure=0;
    let putPressure=0;

    records.forEach(r=>{
        if(Math.abs(r.strikePrice-atm)<= (symbol==="NIFTY"?750:1500)){
            let ceChg=r.CE?r.CE.changeinOpenInterest:0;
            let peChg=r.PE?r.PE.changeinOpenInterest:0;
            if(ceChg>0) callPressure+=ceChg;
            if(peChg>0) putPressure+=peChg;
        }
    });

    let delta=putPressure-callPressure;
    oiDeltaMemory.push(delta);
    if(oiDeltaMemory.length>10) oiDeltaMemory.shift();

    let oiTrend=oiDeltaMemory.reduce((a,b)=>a+b,0);

    // VWAP PROXY (OI weighted direction)
    let vwapBias="Neutral";
    if(delta>0 && oiTrend>0) vwapBias="Above VWAP";
    if(delta<0 && oiTrend<0) vwapBias="Below VWAP";

    // FAKE BREAKOUT DETECTOR
    let fakeBreak=false;
    if(candleDir==="Bullish" && delta<0) fakeBreak=true;
    if(candleDir==="Bearish" && delta>0) fakeBreak=true;

    // TRAP DETECTION
    let trap="None";
    if(candleDir==="Bullish" && callPressure<0) trap="Short Covering Trap";
    if(candleDir==="Bearish" && putPressure<0) trap="Long Unwinding Trap";

    // MOMENTUM
    let momentum=Math.min(100,Math.abs(oiTrend)/200000);
    document.getElementById("momentumBar").style.width=momentum+"%";

    // CONFIDENCE
    let confidence=Math.min(100,Math.abs(delta)/100000);

    // ENTRY LOGIC
    let entry="Wait";
    if(!fakeBreak && confidence>40){
        if(candleDir==="Bullish" && delta>0) entry="Enter CE";
        if(candleDir==="Bearish" && delta<0) entry="Enter PE";
    }

    // SMART SL
    let sl="Use ATM ±0.3%";
    if(confidence>70) sl="Tight SL 0.2%";
    if(confidence<30) sl="Avoid Trade";

    document.getElementById("summary").innerHTML=
        `<b>Symbol:</b> ${symbol}
        | <b>Spot:</b> ${spot}
        <br><br>
        <b>1-Min Direction:</b> ${candleDir}
        | <b>VWAP Proxy:</b> ${vwapBias}
        <br><br>
        <b>Delta Shift:</b> ${delta}
        | <b>Momentum:</b> ${momentum.toFixed(1)}%
        | <b>Confidence:</b> ${confidence.toFixed(1)}%
        <br><br>
        <b>Fake Breakout:</b> ${fakeBreak?"YES ⚠":"No"}
        | <b>Trap:</b> ${trap}
        <br><br>
        <b>Entry:</b> ${entry}
        | <b>Smart SL:</b> ${sl}`;
}

fetchData();
setInterval(fetchData,30000);

</script>
</body>
</html>
